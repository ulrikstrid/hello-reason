steps:
  - task: NodeTool@0
    displayName: "Use Node 8.x"
    inputs:
      versionSpec: 8.x

  - task: DownloadBuildArtifacts@0
    displayName: "Download Linux Artifacts"
    inputs:
      artifactName: Linux
      downloadPath: "_release"

  - script: "mkdir _release/platform-linux"
    displayName: "Create _release/platform-linux"

  - script: "cp -r _release/Linux/ _release/platform-linux"
    displayName: "cp Linux"

  - task: DownloadBuildArtifacts@0
    displayName: "Download macOS Artifacts"
    inputs:
      artifactName: macOS
      downloadPath: "_release"

  - script: "mkdir _release/platform-darwin"
    displayName: "Create _release/platform-darwin"

  - script: "cp -r _release/macOS/ _release/platform-darwin"
    displayName: "cp macOS"

  # - task: DownloadBuildArtifacts@0
  #   displayName: "Download Windows Artifacts"
  #   inputs:
  #     artifactName: Windows
  #     downloadPath: "_release"
  #   continueOnError: true

  # - script: "mkdir _release/platform-windows-x64"
  #   displayName: "Create _release/platform-windows-x64"
  #   continueOnError: true

  # - script: "cp -r _release/Windows/ _release/platform-windows-x64"
  #   displayName: "cp Windows"
  #   continueOnError: true

  - script: "node .ci/pipelines-release.js"
    displayName: "node .ci/pipelines-release.js"
    continueOnError: true

  - script: "npm pack"
    displayName: "npm pack"
    workingDirectory: "_release"

  - task: PublishBuildArtifacts@1
    displayName: "Publish Artifact: Release"
    inputs:
      PathtoPublish: "_release/hello-reason-0.1.0.tgz"
      ArtifactName: Release
